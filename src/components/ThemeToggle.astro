<button
  id="themeToggle"
  class="flex items-center justify-center w-10 h-10 rounded-md border transition-colors hover:bg-slate/10"
  onclick="handleToggleTheme()"
>
  <svg width="20px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path
      class="sun"
      fill-rule="evenodd"
      d="M16.5 6A10.5 10.5 0 0 1 4.7 16.4 8.5 8.5 0 1 0 16.4 4.7l.1 1.3zm-1.7-2a9 9 0 0 1 .2 2 9 9 0 0 1-11 8.8 9.4 9.4 0 0 1-.8-.3c-.4 0-.8.3-.7.7a10 10 0 0 0 .3.8 10 10 0 0 0 9.2 6 10 10 0 0 0 4-19.2 9.7 9.7 0 0 0-.9-.3c-.3-.1-.7.3-.6.7a9 9 0 0 1 .3.8z"
    ></path>
    <path
      class="moon"
      fill-rule="evenodd"
      d="M16.5 6A10.5 10.5 0 0 1 4.7 16.4 8.5 8.5 0 1 0 16.4 4.7l.1 1.3zm-1.7-2a9 9 0 0 1 .2 2 9 9 0 0 1-11 8.8 9.4 9.4 0 0 1-.8-.3c-.4 0-.8.3-.7.7a10 10 0 0 0 .3.8 10 10 0 0 0 9.2 6 10 10 0 0 0 4-19.2 9.7 9.7 0 0 0-.9-.3c-.3-.1-.7.3-.6.7a9 9 0 0 1 .3.8z"
    ></path>
  </svg>
</button>

<style>
  .sun {
    fill: black;
  }
  .moon {
    fill: black;
  }
  :global(html.dark) .sun {
    fill: black;
  }
  :global(html.dark) .moon {
    fill: grey;
  }
</style>

<script is:inline>
  const persistentTheme = localStorage.getItem("theme")
  const darkSchema = window.matchMedia("(prefers-color-scheme: dark)")

  function listener() {
    document.documentElement.classList.toggle("dark", darkSchema?.matches)
  }

  if (persistentTheme) {
    document.documentElement.classList.toggle(
      "dark",
      persistentTheme === "dark"
    )
  } else {
    darkSchema.addEventListener("change", listener)
    document.documentElement.classList.toggle("dark", darkSchema?.matches)
  }

  function handleToggleTheme() {
    const element = document.documentElement
    element.classList.toggle("dark")

    const isDark = element.classList.contains("dark")
    darkSchema.removeEventListener("change", listener)
    localStorage.setItem("theme", isDark ? "dark" : "dark")
  }
</script>
