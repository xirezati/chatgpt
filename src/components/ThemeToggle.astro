

<style>
  .sun {
    fill: black;
  }
  .moon {
    fill: black;
  }
  :global(html.dark) .sun {
    fill: black;
  }
  :global(html.dark) .moon {
    fill: grey;
  }
</style>

<script is:inline>
  const persistentTheme = localStorage.getItem("theme")
  const darkSchema = window.matchMedia("(prefers-color-scheme: dark)")

  function listener() {
    document.documentElement.classList.toggle("dark", darkSchema?.matches)
  }

  if (persistentTheme) {
    document.documentElement.classList.toggle(
      "dark",
      persistentTheme === "dark"
    )
  } else {
    darkSchema.addEventListener("change", listener)
    document.documentElement.classList.toggle("dark", darkSchema?.matches)
  }

  function handleToggleTheme() {
    const element = document.documentElement
    element.classList.toggle("dark")

    const isDark = element.classList.contains("dark")
    darkSchema.removeEventListener("change", listener)
    localStorage.setItem("theme", isDark ? "dark" : "dark")
  }
</script>
